"use strict";var main={init:function(){if(Handlebars.registerHelper("link",(function(e,a){a=Handlebars.escapeExpression(a),e=Handlebars.escapeExpression(e);return new Handlebars.SafeString("<a href='"+a+"' class='button-v1 btn-color-1'><i class='"+e+"'></i></a>")})),Handlebars.registerHelper("inc",(function(e,a){return parseInt(e)+1})),$("[name='httpError']").length&&""!=$("[name='httpError']").val()){var e=$("[name='httpError']").val();$.fancybox.open({src:"assets/ajax/card/error.html",type:"ajax",smallBtn:!1,afterLoad:function(){"true"!=e&&$(".custom-error-message").text(e)}})}},cardTransactionLocations:function(){var e,a=(o=$("#map")).data("template-url"),t=o.data("json-url"),n={url:"assets/images/layout/pin.png",size:new google.maps.Size(100,102),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(50,48)},i=null,o=null,s=[];function r(){$.ajax({type:"GET",url:t,cache:!1}).done((function(t){e=t,o=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(e.mapCenter.lat,e.mapCenter.lng),zoom:11,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1}),function(){a&&$.ajax({url:a,type:"GET",cache:!1}).done((function(a){var t=Handlebars.compile(a)(e);$(".horizontal-list.v1").html(t)})),i&&(i.clearMarkers(),s=[]);for(var t=0;t<e.data.length;++t)r=e.data[t],l=void 0,c=void 0,l=new google.maps.LatLng(r.lat,r.lng),c=new google.maps.Marker({position:l,icon:n,markerLat:r.lat,markerLng:r.lng,selectedId:t,selectedState:!1}),s.push(c);var r,l,c;i=new MarkerClusterer(o,s,{gridSize:40,styles:[{url:"assets/images/layout/map-cluster.png",width:52,height:52,textColor:"#ffffff"}]})}()}))}r(),setInterval((function(){r()}),3e5)},inputAction:function(){if($(".next-input-field").length){var e=$(".next-input-field"),a=e.attr("maxlength");e.keydown((function(e){if(8==e.which&&0==this.value.length)$(this).prev("input").focus();else{if($.inArray(e.which,[8,9,13,19,20,27,33,34,35,36,37,38,39,40,45,46,144,145])>=0)return!0;if(this.value.length>=a)return $(this).next("input").focus(),!1}})).keyup((function(){this.value.length>=a&&$(this).next("input").focus()}))}$(".active-content-event").length&&$(".change-active-class").on({click:function(){var e=$(this),a=e.attr("type"),t=e.data("active-class");if("checkbox"==a)e.is(":checked")?e.parents(".active-content-event").find(".change-active-content[data-active-content='"+t+"']").addClass("active").stop(!1,!1).slideDown():e.parents(".active-content-event").find(".change-active-content[data-active-content='"+t+"']").removeClass("active").stop(!1,!1).slideUp();else if("radio"==a){e.data("open-close")?e.parents(".active-content-event").find(".change-active-content[data-active-content='"+t+"']").addClass("active").stop(!1,!1).slideDown():e.parents(".active-content-event").find(".change-active-content[data-active-content='"+t+"']").removeClass("active").stop(!1,!1).slideUp()}}}).each((function(){$(this).is(":checked")&&$(this).trigger("click")}))},customSelectbox:function(){$(".select-not-find").length&&$(".select-not-find").each((function(e,a){$("select",a).data("select2")||$("select",a).select2({minimumResultsForSearch:-1,dropdownParent:$(a)}).off("select2:open").on("select2:open",(function(e){$(".select2-results .select2-results__options").niceScroll({autohidemode:!1,cursorwidth:4,cursorcolor:"#BCC3CA",cursorborder:2,cursorborderradius:2,horizrailenabled:!0})}))})),$(".select-find").length&&$(".select-find").each((function(e,a){$("select",a).data("select2")||$("select",a).select2({ajax:{url:$(a).find("select").data("json-url"),data:function(e){return{search:e.term}},cache:!1},dropdownParent:$(a)}).off("select2:open").on("select2:open",(function(e){$(".select2-results .select2-results__options").niceScroll({autohidemode:!1,cursorwidth:4,cursorcolor:"#BCC3CA",cursorborder:2,cursorborderradius:2,horizrailenabled:!0})}))})),$(".crime-select").length&&$(".crime-select").each((function(){$(this).select2({ajax:{url:$(this).data("url"),dataType:"json",processResults:function(e,a){return a.page=a.page||1,{results:e.data,pagination:{more:30*a.page<e.total_count}}},cache:!1},minimumResultsForSearch:-1,templateResult:function(e){if(e.loading)return e.text;return $("<div class='select-custom-options'><div class='title'>"+e.title+"</div><div class='description'>"+e.description+"</div></div>")},templateSelection:function(e){return e.id}})}))},addWitness:function(){if($(".addWitness").length){var e=1;$(".addWitness").on({click:function(){var a="<div class='form-row'><a href='javascript:;' class='button button-v4 color-1 line-height-sml removeWitness'><i class='icon-cancel'></i></a><span class='label witness-label'>Witness Statments</span><div class='input-group-content'><label><input type='text' name='witnessName"+e+"' placeholder='Name'></label><label><input type='text' name='witnessSurname"+e+"' placeholder='Surname'></label></div><div class='form-row'><label><span class='label'></span><textarea name='witnessStatement"+e+"' placeholder='Statement'></textarea></label></div></div>";$(".witness-container").append(a),e++,$(".removeWitness").off("click").on({click:function(){$(this).parents(".form-row").remove()}})}})}},datePicker:function(){if($(".datepicker").length&&$(".datepicker").each((function(){$(this).datepicker()})),$("#calendar").length){var e=$("#calendar").data("next-url");$("#calendar").datepicker({onSelect:function(a,t){window.location.href=e+"?calendarDate="+a}})}},timePicker:function(){$(".timepicker").length&&$(".timepicker").timepicker({timeFormat:"h:mm p",dynamic:!1,dropdown:!0,scrollbar:!0,zindex:99999})},dropzone:function(){$(".photo-upload").length&&(Dropzone.autoDiscover=!1,$(".photo-upload").each((function(){var e=$(this).find(".photo-upload-inner"),a=e.data("upload-url"),t=e.data("delete-url"),n=e.data("max-files")?e.data("max-files"):null;e.hasClass("dz-started")||e.dropzone({autoProcessQueue:!1,url:a,maxFiles:n,addRemoveLinks:!0,dictRemoveFile:"",thumbnailMethod:"contain",dictDefaultMessage:null,removedfile:function(e){var a=e.name;$.ajax({url:t,type:"POST",data:{fileName:a},dataType:"html"}).done((function(a){var t;if(JSON.parse(a).status)return null!=(t=e.previewElement)?t.parentNode.removeChild(e.previewElement):void 0;$.fancybox.open({src:"/tpcmsWebAdmin/assets/ajax/card/error.html",type:"ajax",smallBtn:!1})})).fail((function(e){$.fancybox.open({src:"/tpcmsWebAdmin/assets/ajax/card/error.html",type:"ajax",smallBtn:!1})}))},init:function(){var a=this;if(a.on("addedfile",(function(e){null!=a.files[n]&&a.removeFile(a.files[0])})),e.parents(".photo-upload").hasClass("upload-view")){var t=e.data("upload-ajax-url");$.ajax({url:t}).done((function(e){for(var t=0;t<e.data.length;t++)a.files.push(e.data[t]),a.emit("addedfile",e.data[t]),a.emit("thumbnail",e.data[t],e.data[t].url),a.emit("complete",e.data[t]),e.data[t].previewElement.classList.add("dz-success"),e.data[t].previewElement.classList.add("dz-complete")}))}},accept:function(e,t){var n=new FileReader;n.onload=function(t){$.ajax({url:a,method:"POST",dataType:"html",data:{fileBase64:t.target.result,fileName:e.name,fileType:e.type,fileSize:e.size,key:null},cache:!1,timeout:9e5,xhr:function(){var a=$.ajaxSettings.xhr();if(e.previewElement){var t=e.previewElement.querySelector("[data-dz-uploadprogress]");a.upload&&a.upload.addEventListener("progress",(function(e){var a=e.total,n=e.loaded;if(e.lengthComputable){var i=Math.floor(n/a*100);t.style.width=i+"%"}}),!1)}return a}}).done((function(a){JSON.parse(a).status?$(e.previewElement).addClass("dz-success dz-complete"):($(e.previewElement).addClass("dz-error dz-complete"),$(e.previewElement).find("[data-dz-errormessage]").text(JSON.parse(a).message),$.fancybox.open({src:"/tpcmsWebAdmin/assets/ajax/card/error.html",type:"ajax",smallBtn:!1}))})).fail((function(a){$(e.previewElement).addClass("dz-error dz-complete"),$(e.previewElement).find("[data-dz-errormessage]").text(a.responseText),$.fancybox.open({src:"/tpcmsWebAdmin/assets/ajax/card/error.html",type:"ajax",smallBtn:!1})}))},n.readAsDataURL(e)}})})))},pagination:function(){$(".pagination").each((function(e,a){$("select",a).on({change:function(){var e=$("option:selected",this).prev("option"),t=$("option:selected",this).next("option");e.length?$(".prev",a).removeClass("disabled"):$(".prev",a).addClass("disabled"),t.length?$(".next",a).removeClass("disabled"):$(".next",a).addClass("disabled")}}).trigger("change"),$(".prev",a).on({click:function(e){var t=$("select",a),n=$("option:selected",t).prev("option");n.length&&(n.prop("selected",!0),t.trigger("change")),e.preventDefault()}}),$(".next",a).on({click:function(e){var t=$("select",a),n=$("option:selected",t).next("option");n.length&&(n.prop("selected",!0),t.trigger("change")),e.preventDefault()}})}))},filterControl:function(){var e=$.Deferred();return $(".site-data-container").length?$(".site-data-container").each((function(){var a,t,n=$(this),i=$(".site-data-filters",n),o=$(".site-data-content",n),s=$(".site-data-pagination",n),r=n.data("template-url"),l=n.data("json-url");function c(t){n.addClass("loading"),t||$("select",s).val("1").data("value","1");var i=$(":input",n).serialize();$.ajax({type:"GET",url:l,dataType:"json",data:i,cache:!1,success:function(i){if(i.data.length||i.data.tbody.length){var r=Handlebars.compile(a)(i);if($(".error-text",n).text("").hide(),$(".complaints-detail-content").length&&$(".complaints-detail-content").html(""),o.html(r),n.removeClass("loading"),o.show(),i.pages>1?s.show():s.hide(),!t){$("select",s).html("");for(var l=1;l<=i.pages;l++)$("select",s).append('<option value="'+l+'">'+l+"</option>")}main.fancybox(),e.resolve()}else n.removeClass("loading"),s.hide(),o.html("").hide(),$(".error-text",n).text(i.message).show(),e.resolve()}})}$.ajax({type:"GET",url:r,async:!1,cache:!1,success:function(e){a=e}});var d=$(":input",i).serialize();i.on({submit:function(e){t=$(":input",i).serialize(),d!=t&&(d=t,c()),e.preventDefault()}}),$(".change-on-submit").length&&$(".change-on-submit").on({change:function(){c()}}),$("select",s).on({change:function(){$(this).val()!=$(this).data("value")&&($(this).data("value",$(this).val()),c(!0))}}),c()})):e.resolve(),e},filterControlv1:function(){var e=$.Deferred();return $(".site-data-container-v1").length?$(".site-data-container-v1").each((function(){var a,t,n=$(this),i=$(".site-data-filters",n),o=$(".site-data-content",n),s=$(".site-data-pagination",n),r=n.data("template-url"),l=n.data("json-url");function c(t){n.addClass("loading"),t||$("select",s).val("1").data("value","1");var i=$(":input",n).serialize();$.ajax({type:"GET",url:l,dataType:"json",data:i,cache:!1,success:function(i){if(i.data.length||i.data.thead.length){var r=Handlebars.compile(a)(i);if($(".error-text",n).text("").hide(),$(".complaints-detail-content").length&&$(".complaints-detail-content").html(""),o.html(r),n.removeClass("loading"),o.show(),i.pages>1?s.show():s.hide(),!t){$("select",s).html("");for(var l=1;l<=i.pages;l++)$("select",s).append('<option value="'+l+'">'+l+"</option>")}main.fancybox(),e.resolve()}else n.removeClass("loading"),s.hide(),o.html("").hide(),$(".error-text",n).text(i.message).show(),e.resolve()}})}$.ajax({type:"GET",url:r,async:!1,cache:!1,success:function(e){a=e}});var d=$(":input",i).serialize();i.on({submit:function(e){t=$(":input",i).serialize(),d!=t&&(d=t,c()),e.preventDefault()}}),$(".change-on-submit").length&&$(".change-on-submit").on({change:function(){c()}}),$("select",s).on({change:function(){$(this).val()!=$(this).data("value")&&($(this).data("value",$(this).val()),c(!0))}}),c()})):e.resolve(),e},carousel:function(){$(".card-carousel").length&&$(".card-carousel").owlCarousel({rtl:!0,margin:15,nav:!0,navText:["<i class='icon-right-open'></i>","<i class='icon-left-open'></i>"],dots:!1})},fancybox:function(){$.fancybox.defaults.touch=!1,$("[data-fancybox-card]").length&&$("[data-fancybox-card]").fancybox({smallBtn:!1,toolbar:!1}),$("[data-fancybox-search]").length&&$("[data-fancybox-search]").fancybox({smallBtn:!1,toolbar:!1,beforeLoad:function(e,a,t){var n=t.opts.$orig;n&&n.parents(".search-box-v2").length&&n.parents(".search-box-v2").addClass("fancy-click-element")}}),$(document).on("afterLoad.fb",(function(e,a){main.carousel(),main.timePicker(),main.dropzone(),main.validationsCommon()}))},validationMethods:function(){$(".no-paste").bind("cut copy paste",(function(e){e.preventDefault()})),$(".only-number").on({keydown:function(e){-1!==$.inArray(e.keyCode,[46,8,9,27,13,110,190])||65==e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}}),$.validator.addMethod("lettersonly",(function(e,a){return this.optional(a)||/^[a-z ğüöçıİş]+$/i.test(e)}))},validationsCommon:function(){var e,a;$("form").length&&$("form").each((function(t,n){e=$(".form-general-success",n),a=$(".form-general-error",n)}));var t={ignore:".skip-validation, .dynamic-skip-validation",errorElement:"span",errorPlacement:function(e,a){e.addClass("text-danger").appendTo(a.parents(".form-row"))},highlight:function(e,a,t){$(e).parents(".form-row").removeClass(t).addClass(a)},unhighlight:function(e,a,t){$(e).parents(".form-row").removeClass(a).addClass(t)},submitHandler:function(t){if(e.hide(),a.hide(),($(t).hasClass("login-user-name")||$(t).hasClass("login-user-code")||$(t).hasClass("login-pass-code"))&&$(t).find(".form-container").addClass("loading"),$(t).data("url")){var n=$(t).data("url"),i=$(t).attr("method")||"GET",o=$(t).attr("enctype"),s=$(t).serialize(),r="";($(t).hasClass("login-user-code")||$(t).hasClass("login-pass-code"))&&($(t).find("input[type='text']").each((function(){var e=$(this).val();r+=e})),s="code="+r);var l={url:n,type:i,dataType:"json",data:s,cache:!1,timeout:9e5};"multipart/form-data"===o&&$.extend(l,{processData:!1,contentType:!1,timeout:6e4,data:new FormData(t)}),$.ajax(l).done((function(e){if(e.status){if(e.nextUrl)window.location.href=e.nextUrl;else if($(t).hasClass("previousCase")||$(t).hasClass("permitsCreateMissionCard")){var a=$(t).data("template-url");$.ajax({url:a,method:"GET"}).done((function(a){$(t).find(".dynamic-content").addClass("loading");var n=Handlebars.compile(a)(e);$(t).find(".dynamic-content").html(n).removeClass("loading"),$(".previous-case-id").length&&$(".previous-case-id").off("click").on({click:function(){var e=$(this).data("case-id");$(".fancy-click-element").find(".add-previous-case-id").val(e),$.fancybox.close()}}),$(".create-mission-card").length&&$(".create-mission-card").off("click").on({click:function(){var e=$(this),a=e.data("officer-id"),t=e.data("officer-name"),n=e.data("command-center");$(".add-create-mission-card-id").val(a),$(".add-create-mission-card-name").val(t),$(".add-create-mission-card-command-center").val(n),$.fancybox.close()}})}))}}else e.message&&($(t).find(".form-general-error .alert-title").text(e.message),$(t).find(".form-general-error").show()),($(t).hasClass("login-user-name")||$(t).hasClass("login-user-code")||$(t).hasClass("login-pass-code"))&&$(t).find(".form-container").removeClass("loading")}))}else t.submit()}},n=$(".previousCase");if(n.length){var i=$.extend({},t);n.validate(i)}var o=$(".permitsCreateMissionCard");if(o.length){i=$.extend({},t);o.validate(i)}var s=$(".login-user-name");if(s.length){i=$.extend({},t,{rules:{username:{required:!0}},messages:{username:{required:"This field cannot be empty"}}});s.validate(i)}var r=$(".login-user-code");if(r.length){i=$.extend({},t,{groups:{inputGroup:"userCode1 userCode2 userCode3 userCode4 userCode5"},rules:{userCode1:{required:!0},userCode2:{required:!0},userCode3:{required:!0},userCode4:{required:!0},userCode5:{required:!0}},messages:{userCode1:{required:"This field cannot be empty"},userCode2:{required:"This field cannot be empty"},userCode3:{required:"This field cannot be empty"},userCode4:{required:"This field cannot be empty"},userCode5:{required:"This field cannot be empty"}}});r.validate(i)}var l=$(".login-pass-code");if(l.length){i=$.extend({},t,{groups:{inputGroup:"passCode1 passCode2 passCode3"},rules:{passCode1:{required:!0},passCode2:{required:!0},passCode3:{required:!0}},messages:{passCode1:{required:"This field cannot be empty"},passCode2:{required:"This field cannot be empty"},passCode3:{required:"This field cannot be empty"}}});l.validate(i)}var c=$(".notification");if(c.length){i=$.extend({},t,{});c.validate(i)}},alertify:function(e,a,t){var n="<div class='alertify "+e+"'><p class='message'>"+a+"</p></div>";$("body").append(n),$(".alertify").fadeIn(300),setInterval((function(){$(".alertify").fadeOut(300,(function(){$(this).remove()}))}),t)}};function initMap(){$("#map").length&&main.cardTransactionLocations()}$((function(){main.init(),main.inputAction(),main.customSelectbox(),main.addWitness(),main.datePicker(),main.timePicker(),main.dropzone(),main.carousel(),main.fancybox(),main.pagination(),main.filterControl(),main.filterControlv1(),main.validationMethods(),main.validationsCommon()}));